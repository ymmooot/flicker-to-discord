name: main

on:
  schedule:
    - cron: '*/15 * * * *'

env:
  FLICKR_IDS: ${{ vars.FLICKR_IDS }}
  DISCORD_WEBHOOK_URL: ${{ vars.DISCORD_WEBHOOK_URL }}

jobs:
  run:
    runs-on: ubuntu-latest
    environment: env
    steps:
      - uses: actions/checkout@master
      - uses: actions/cache@v3
        with:
          path: rss-store.json
          # This ensures that a new cache is created even if a cache hit occurs.
          key: json-${{ github.run_id }}
          restore-keys: json-
      - uses: denoland/setup-deno@v1
        with:
          deno-version: v1.x
      - run: deno run --allow-net --allow-env --allow-read --allow-write ./src/index.ts